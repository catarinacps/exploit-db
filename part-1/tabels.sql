create table USUARIO (
  apelido varchar(20) not null,
  email varchar(256) not null,
  senha varchar(512) not null,
  tipou varchar(20) not null,
  primary key (apelido),
  UNIQUE (apelido),
  UNIQUE (email)
);

create table MODERADOR (
  apelido char(10) not null,
  cargo varchar(20) not null,
  descr varchar(512) not null,
  primary key (apelido),
  foreign key (apelido) references USUARIO
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

create table VERIFICADOR (
  apelido char(10) not null,
  ip varchar(16) not null,
  cert varchar(50) not null,
  primary key (apelido),
  foreign key (apelido) references USUARIO
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

create table ENVIAVEL (
  codenv char(10) not null,
  estado boolean not null,
  datap date not null,
  tipoe varchar(20) not null,
  usuario varchar(20) not null,
  moderador char(10),
  primary key (codenv),
  foreign key (moderador) references MODERADOR
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  foreign key (usuario) references USUARIO
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

create table ARTIGO (
  codenv char(10) not null,
  lingua char(5) not null,
  plat varchar(20),
  nome varchar(100) not null,
  arqa bytea not null,
  primary key (codenv),
  foreign key (codenv) references ENVIAVEL
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  UNIQUE (arqa)
);

create table DORK (
  codenv char(10) not null,
  busca varchar(1000) not null,
  descr varchar(512) not null,
  primary key (codenv),
  foreign key (codenv) references ENVIAVEL
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

create table VERIFICAVEL (
  codv char(10) not null,
  plat varchar(20) not null,
  nome varchar(100) not null,
  fonte bytea not null,
  tipov varchar(9) not null,
  codenv char(10) not null,
  primary key (codv),
  foreign key (codenv) references ENVIAVEL
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

create table TIPO (
  nome varchar(50) not null,
  descr varchar(1000) not null,
  primary key (nome)
);

create table CVE (
  codcve char(10) not null,
  url varchar(512) not null,
  primary key (codcve),
  UNIQUE(codcve)
);

create table EXPLOIT (
  codv char(10) not null,
  tipoe varchar(50) not null,
  cve char(10),
  primary key (codv),
  foreign key (codv) references VERIFICAVEL
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  foreign key (tipoe) references TIPO
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  foreign key (cve) references CVE
    ON DELETE SET NULL
    ON UPDATE CASCADE
);

create table SHELLCODE (
  codv char(10) not null,
  tamanho integer not null,
  primary key (codv),
  foreign key (codv) references VERIFICAVEL
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

create table VERIFICACAO (
  codverif char(10) not null,
  verificador char(10),
  codv char(10) not null,
  primary key (codverif),
  foreign key (verificador) references VERIFICADOR
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  foreign key (codv) references VERIFICAVEL
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

create table APP (
  nomeapp varchar(100) not null,
  arqapp bytea not null,
  tamanho integer not null,
  primary key (nomeapp)
);

create table EXPLORACAO (
  code char(10) not null,
  exploit char(10) not null,
  app varchar(100),
  primary key (code),
  foreign key (exploit) references EXPLOIT
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  foreign key (app) references APP
    ON DELETE SET NULL
    ON UPDATE CASCADE
);

create table INCIDENTE (
  codi char(10) not null,
  site varchar(512) not null,
  datai date not null,
  descr varchar(1000) not null,
  primary key (codi),
  unique (site, datai)
);

create table CAUSA (
  codc char(10) not null,
  cve char(10) not null,
  codi char(10) not null,
  primary key (codc),
  foreign key (cve) references CVE
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  foreign key (codi) references INCIDENTE
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

create table VAZAMENTO (
  codvaz char(10) not null,
  site varchar(512) not null,
  datav date not null,
  primary key (codvaz)
);

create table DADOS (
  email varchar(256) not null,
  vaz varchar(512) not null,
  fone boolean not null,
  senha boolean not null,
  endr boolean not null,
  primary key (email, vaz)
);
-- Script containing the demanded stored procedure for the assignment.
--
-- Authors:
-- Henrique Corrêa Pereira da Silva
-- Felipe Colombelli

-- Verificar se o email é válido e a senha contém no mínimo coisas... sempre que
-- tentar atualizar um usuário (esse é o gatilho).

create procedure insercao_usuario(
    apelido_ varchar(20),
    email_ varchar(256),
    senha_ varchar(512),
    tipou_ varchar(20)
)
language sql
as $$
update USUARIO
set email = email_, senha = senha_, tipou = tipou_
where apelido = apelido_ and email_ like '%_@__%.__%' and LENGHT(senha_) > 8;
$$;

create trigger trigger_inserir_usuario
instead of update on USUARIO
for each row
execute procedure insercao_usuario(OLD.apelido, NEW.email, NEW.senha, NEW.tipou);

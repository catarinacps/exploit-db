-- Script containing the demanded stored procedure for the assignment.
--
-- Authors:
-- Henrique Corrêa Pereira da Silva
-- Felipe Colombelli

-- Verificar se o email é válido e a senha contém no mínimo coisas... sempre que
-- tentar atualizar um usuário (esse é o gatilho).

create procedure insercao_usuario(
    @apelido varchar(20),
    @email varchar(256),
    @senha varchar(512),
    @tipou varchar(20)
)
language sql
as $$
update USUARIO
set email = @email, senha = @senha, tipou = @tipou
where apelido = @apelido and email like '%_@__%.__%' and LENGHT(senha) > 8;
$$;

create trigger trigger_inserir_usuario
instead of update on USUARIO
for each row
execute procedure insercao_usuario(OLD.apelido, NEW.email, NEW.senha, NEW.tipou);

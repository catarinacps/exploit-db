-- Script containing the demanded queries for the assignment.
--
-- Authors:
-- Henrique Corrêa Pereira da Silva
-- Felipe Colombelli


-- Todos os exploits do tipos DoS explorados por um determinado usuário (nesse exemplo, mutano) na plataforma Windows
	select verif.nome
	from ENVIAVEL env natural join VERIFICAVEL verif join EXPLOIT ex using (codv)
	where env.usuario = 'mutano' and env.tipoe = 'Exploit' and verif.plat='Windows' and ex.tipoe='DoS';

	
-- Todos os dados de vazamentos associados a um dado usuário do ExploitDB, assim
--  como quais dados pessoais foram vazados.
	select d.email, v.site, v.datav, d.fone, d.senha, d.endr
	from USUARIO join DADOS d using (email) join VAZAMENTO v on (d.vaz = v.codvaz);
	

-- Todos os dados de aplicativos associados a determinado CVE.
	select APP.nomeapp, APP.arqapp, APP.tamanho, ex.cve
	from APP join EXPLORACAO e on (APP.nomeapp = e.app) join EXPLOIT ex on (ex.codv = e.exploit) 
	where ex.cve <> 'null';


-- Os verificadores que verificaram Shellcodes, ordenados pelo tamanho médio dos
--  shellcodes que eles verificaram.
	



-- Os dados de vazamentos dos e-mails que tiveram seus dados vazados nos mesmos
--  sites (e talvez outros) que um dado e-mail (nesse exemplo, arankar@gmail.com).
	select *
	from DADOS d join VAZAMENTO v on (v.codvaz = d.vaz)
	where d.email <> 'arankar@gmail.com' and NOT EXISTS (
		select * 
		from DADOS d1 join VAZAMENTO v1 on (v1.codvaz = d1.vaz)
		where d1.email = 'arankar@gmail.com' and site not in (
			select distinct site
			from DADOS d2 join VAZAMENTO v2 on (v2.codvaz = d2.vaz) 
			where d2.email = d.email
		)
	);

	

-- Os verificáveis que ainda não foram verificados e cuja plataforma é a que
--  possui o maior número de artigos associados.
	

	
	
	
-- Visão: Todos os enviáveis que não foram revisados ainda.
	create view Nao_Revisados as
		select *
		from enviavel
		where estado = false;

-- E que foram enviados antes de uma dada data (nesse exemplo, 2019-07-20)
	select *
	from Nao_Revisados
	where datap < '2019-07-20';
-- E que são exploits relacionados a um CVE
	select *
	from Nao_Revisados nr natural join VERIFICAVEL join EXPLOIT e using(codv)
	where cve <> 'null';